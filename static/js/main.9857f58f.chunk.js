(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},23:function(e,t,n){e.exports=n(54)},28:function(e,t,n){},53:function(e,t,n){},54:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(13),s=n.n(o),l=(n(28),n(4)),i=n(5),c=n(7),d=n(6),h=n(8),m=n(2),g=n(1);function u(e,t,n){var a=new FileReader;a.readAsArrayBuffer(e),a.onload=function(){var e=function(e){var t=new DataView(e);if(65496!=t.getUint16(0,!1))return-2;var n=t.byteLength,a=2;for(;a<n;){var r=t.getUint16(a,!1);if(a+=2,65505==r){if(1165519206!=t.getUint32(a+=2,!1))return-1;var o=18761==t.getUint16(a+=6,!1);a+=t.getUint32(a+4,o);var s=t.getUint16(a,o);a+=2;for(var l=0;l<s;l++)if(274==t.getUint16(a+12*l,o))return t.getUint16(a+12*l+8,o)}else{if(65280!=(65280&r))break;a+=t.getUint16(a,!1)}}return-1}(a.result),n="data:image/jpg;base64,"+function(e){for(var t,n="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),o=r.byteLength,s=o%3,l=o-s,i=0;i<l;i+=3)t=r[i]<<16|r[i+1]<<8|r[i+2],n+=a[(16515072&t)>>18]+a[(258048&t)>>12]+a[(4032&t)>>6]+a[63&t];1==s?(t=r[l],n+=a[(252&t)>>2]+a[(3&t)<<4]+"=="):2==s&&(t=r[l]<<8|r[l+1],n+=a[(64512&t)>>10]+a[(1008&t)>>4]+a[(15&t)<<2]+"=");return n}(a.result),r=new Image;r.setAttribute("src",n),r.onload=function(){var n=Math.floor(r.height*(800/r.width)),a=document.createElement("canvas");a.width=800,a.height=n;var o=a.getContext("2d");switch([5,6,7,8].indexOf(e)>-1?(a.width=n,a.height=800):(a.width=800,a.height=n),e){case 2:o.transform(-1,0,0,1,800,0);break;case 3:o.transform(-1,0,0,-1,800,n);break;case 4:o.transform(1,0,0,-1,0,n);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,n,0);break;case 7:o.transform(0,-1,-1,0,n,800);break;case 8:o.transform(0,-1,1,0,0,800);break;default:o.transform(1,0,0,1,0,0)}o.drawImage(r,0,0,800,n),t(a.toDataURL("image/jpeg",.7))}},a.onerror=n}var p=n(9),f=n.n(p);var b=function(e){return e&&e.startsWith("zh")?"cht":"eng"},C=(n(20),n(21),n(22),n(53),"\u9ed8\u66f8\u6613 Dict-Ez\uff1a\u5148\u9078\u64c7\u8a9e\u8a00"),E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={toolbar_msg:C,lang:S,isPostingOcr:!1,scannedFileBase64:"",errorTitle:"",errorContent:""},n.handleReset=n.handleReset.bind(Object(m.a)(n)),n.handleCapturing=n.handleCapturing.bind(Object(m.a)(n)),n.handleErrorDialogCancel=n.handleErrorDialogCancel.bind(Object(m.a)(n)),n.processBase64Image=n.processBase64Image.bind(Object(m.a)(n)),n.processBase64ImageError=n.processBase64ImageError.bind(Object(m.a)(n)),n.processOcrContent=n.processOcrContent.bind(Object(m.a)(n)),n.processOcrError=n.processOcrError.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"resetAll",value:function(){this.setState({toolbar_msg:C,lang:S,isPostingOcr:!1,scannedFileBase64:"",errorTitle:"",errorContent:""})}},{key:"processBase64Image",value:function(e){this.setState({scannedFileBase64:e}),this.setState({toolbar_msg:"\u9ed8\u66f8\u6613 Dict-Ez\uff1a\u6309\u4e0b\u5716\u8c61\u8fa8\u6790"})}},{key:"processBase64ImageError",value:function(e){console.log(e),this.setState({errorTitle:"BASE64 \u7de8\u78bc\u7570\u5e38",errorContent:JSON.stringify(e)})}},{key:"processOcrContent",value:function(e){var t="";e.data.ParsedResults.forEach(function(e){t+=e.ParsedText+"\n"}),this.setState({isPostingOcr:!1}),this.props.onOcrCompleted(this.state.lang,t),console.log(t)}},{key:"processOcrError",value:function(e){console.log(e),this.setState({isPostingOcr:!1,errorTitle:"\u6587\u5b57\u8fa8\u8b58\u7570\u5e38",errorContent:JSON.stringify(e)})}},{key:"handleReset",value:function(e){this.resetAll()}},{key:"handleCapturing",value:function(e){u(e.target.files[0],this.processBase64Image,this.processBase64ImageError)}},{key:"hangleLangBtnClick",value:function(e,t){document.getElementById("imgScanned").click(),this.setState({lang:e})}},{key:"handleErrorDialogCancel",value:function(e){this.state.errorTitle.length>0&&this.setState({errorTitle:"",errorContent:""})}},{key:"render",value:function(){var e=this;return r.a.createElement(g.Page,{renderToolbar:function(){return r.a.createElement(g.Toolbar,null,r.a.createElement("div",{className:"center"},e.state.toolbar_msg),r.a.createElement("div",{className:"right"},r.a.createElement(g.ToolbarButton,{onClick:e.handleReset},r.a.createElement("i",{className:"zmdi zmdi-refresh"}))))}},r.a.createElement(g.Modal,{isOpen:this.state.isPostingOcr},r.a.createElement("p",null,"Loading ..."),r.a.createElement(g.ProgressCircular,{indeterminate:!0})),r.a.createElement(g.AlertDialog,{isOpen:this.state.errorTitle.length>0,onCancel:this.handleErrorDialogCancel,cancelable:!0},r.a.createElement("div",{className:"alert-dialog-title",onClick:this.handleErrorDialogCancel},r.a.createElement("b",null,this.state.errorTitle)),r.a.createElement("div",{className:"alert-dialog-content"},this.state.errorContent),r.a.createElement("div",{className:"alert-dialog-footer"},r.a.createElement(g.Button,{onClick:this.handleErrorDialogCancel,className:"alert-dialog-button"},"Ok"))),r.a.createElement("div",{className:"div-bgimg"},r.a.createElement("input",{type:"file",id:"imgScanned",name:"imgScanned",accept:"image/*",capture:"camera",style:{display:"none"},onChange:this.handleCapturing,onClick:function(e){e.target.value=null}}),this.state.scannedFileBase64&&r.a.createElement("img",{src:this.state.scannedFileBase64,alt:"Optical Character Recognition",height:"100%",onClick:function(t){e.setState({isPostingOcr:!0}),function(e,t,n,a,r){var o="https://api.ocr.space/parse/image",s=new FormData;s.append("apikey",e),s.append("base64Image",n),s.append("language",b(t)),console.log("POST to ["+o+"] started"),f.a.post(o,s).then(function(e){a(e)}).catch(function(e){r(e)}).then(function(){console.log("POST to ["+o+"] completed")})}("ff0751fd8988957",e.state.lang,e.state.scannedFileBase64,e.processOcrContent,e.processOcrError)}})),r.a.createElement(g.BottomToolbar,{modifier:"material"},r.a.createElement(g.Segment,{style:{width:"100%"},modifier:"material"},r.a.createElement(g.ToolbarButton,{onClick:function(t){e.hangleLangBtnClick(P,t)}},"\u5ee3\u6771\u8a71"),r.a.createElement(g.ToolbarButton,{onClick:function(t){e.hangleLangBtnClick(j,t)}},"\u666e\u901a\u8a9e\uff08\u7e41\uff09"),r.a.createElement(g.ToolbarButton,{onClick:function(t){e.hangleLangBtnClick(w,t)}},"English"))))}}]),t}(a.Component);function v(e,t,n,a,r,o){var s="https://api.voicerss.org/",l=new FormData;l.append("key",e),l.append("src",n),l.append("hl",y(t)),l.append("b64","true"),l.append("r",a),console.log("POST to ["+s+"] started"),f.a.post(s,l).then(function(e){r(e)}).catch(function(e){o(e)}).then(function(){console.log("POST to ["+s+"] completed")})}var y=function(e){return e||"en-US"},T="\u6309\u6b64\u64ad\u653e",k=50,O=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).props.ttsContent?n.state={toolbar_msg:T,ttsContents:n.props.ttsContent.trim().split(/\r?\n/),speechSpeed:k,isPostingTts:!1,errorTitle:"",errorContent:""}:n.state={toolbar_msg:T,ttsContents:[],speechSpeed:k,isPostingTts:!1,errorTitle:"",errorContent:""},n.handleReset=n.handleReset.bind(Object(m.a)(n)),n.handleBackHome=n.handleBackHome.bind(Object(m.a)(n)),n.handlePlay=n.handlePlay.bind(Object(m.a)(n)),n.handlePlayAll=n.handlePlayAll.bind(Object(m.a)(n)),n.handleUpdateItem=n.handleUpdateItem.bind(Object(m.a)(n)),n.handleMoveItem=n.handleMoveItem.bind(Object(m.a)(n)),n.handleErrorDialogCancel=n.handleErrorDialogCancel.bind(Object(m.a)(n)),n.processTtsContent=n.processTtsContent.bind(Object(m.a)(n)),n.processTtsError=n.processTtsError.bind(Object(m.a)(n)),n.playVoice=n.playVoice.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"resetAll",value:function(){this.props.ttsContent?this.setState({ttsContents:this.props.ttsContent.trim().split(/\r?\n/),speechSpeed:k,isPostingTts:!1,errorTitle:"",errorContent:""}):this.setState({ttsContents:[],speechSpeed:k,isPostingTts:!1,errorTitle:"",errorContent:""})}},{key:"handleBackHome",value:function(e){this.resetAll(),this.props.onBackToHome()}},{key:"handleReset",value:function(e){this.resetAll()}},{key:"handlePlay",value:function(e,t){this.state.isPostingTts?(console.log("Posting to TTS in progress rejects a new coming request."),this.setState({errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:"\u8a9e\u97f3\u8f49\u63db\u9032\u884c\u4e2d\uff0c\u8acb\u7a0d\u5019\u3002"})):(this.setState({isPostingTts:!0}),v("679dc139ae34411489ad95b33225e6ed",this.props.lang,t,Math.floor(this.state.speechSpeed/5)-10,this.processTtsContent,this.processTtsError))}},{key:"handlePlayAll",value:function(e){this.playFromArray(this.state.ttsContents.slice())}},{key:"playFromArray",value:function(e){var t,n=this,a="";if(void 0!==typeof e&&null!==e&&e.length>0)for(;e.length>0&&(t=a+"\n"+e[0],encodeURI(t).split(/%..|./).length-1<=9e4);)a+="\n"+e.shift();""!==a.trim()&&v("679dc139ae34411489ad95b33225e6ed",this.props.lang,a,Math.floor(this.state.speechSpeed/5)-10,function(t){if(void 0!==typeof t&&null!==t){var a=t.data;if(a.startsWith("ERROR"))console.log("Speech can't be played. Please try next time."),console.log(a),n.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:JSON.stringify(a)});else n.playVoice(a)?n.playFromArray(e):(console.log("Speech can't be played. Please try next time."),n.setState({isPostingTts:!1,errorTitle:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38",errorContent:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38\uff0c\u8acb\u91cd\u8a66\u3002"}))}else console.log("Speech can't be played. Please try next time."),n.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:"\u8a9e\u97f3\u64ad\u653e\u7570\u5e38\uff0c\u8acb\u91cd\u8a66\u3002"})},function(e){console.log(e),n.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:JSON.stringify(e)})})}},{key:"handleUpdateItem",value:function(e,t){this.setState(function(n){return{ttsContents:n.ttsContents.map(function(n,a){return a===t?e.target.value:n})}})}},{key:"handleMoveItem",value:function(e,t,n){if(t+n<0||t+n>=this.state.ttsContents.length)console.log("Invalid Movement.");else{var a=this.state.ttsContents[t],r=this.state.ttsContents[t+n];this.setState(function(e){return{ttsContents:e.ttsContents.map(function(e,o){return o===t?r:o===t+n?a:e})}})}}},{key:"processTtsContent",value:function(e){if(void 0!==typeof e&&null!==e){var t=e.data;if(t.startsWith("ERROR"))console.log("Speech can't be played. Please try next time."),console.log(t),this.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:JSON.stringify(t)});else this.playVoice(t)||(console.log("Speech can't be played. Please try next time."),this.setState({isPostingTts:!1,errorTitle:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38",errorContent:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38\uff0c\u8acb\u91cd\u8a66\u3002"}))}else console.log("Speech can't be played. Please try next time."),this.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:"\u8a9e\u97f3\u64ad\u653e\u7570\u5e38\uff0c\u8acb\u91cd\u8a66\u3002"});this.setState({isPostingTts:!1})}},{key:"processTtsError",value:function(e){console.log(e),this.setState({isPostingTts:!1,errorTitle:"\u8a9e\u97f3\u8f49\u63db\u7570\u5e38",errorContent:JSON.stringify(e)})}},{key:"playVoice",value:function(e){var t=document.querySelector("#audioPlayback");if(!t.src||t.paused||t.ended){t.src=e,t.load();var n=t.play();return void 0!==n?n.then(function(){console.log("Automatic playback started!")}).catch(function(e){console.log(e),this.setState({isPostingTts:!1,errorTitle:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38",errorContent:JSON.stringify(e)})}):(console.log("audio returns undefined."),this.setState({isPostingTts:!1,errorTitle:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38",errorContent:"\u672a\u80fd\u8fd4\u56de\u8a9e\u97f3\u3002"})),n}return console.log("audio element is not available."),this.setState({isPostingTts:!1,errorTitle:"\u64ad\u653e\u8a9e\u97f3\u7570\u5e38",errorContent:"\u672a\u80fd\u7522\u751f\u8a9e\u97f3\u5143\u4ef6\u3002"}),null}},{key:"handleErrorDialogCancel",value:function(e){this.state.errorTitle.length>0&&this.setState({errorTitle:"",errorContent:""})}},{key:"render",value:function(){var e=this;return r.a.createElement(g.Page,{renderToolbar:function(){return r.a.createElement(g.Toolbar,null,r.a.createElement("div",{className:"left"},r.a.createElement(g.ToolbarButton,{onClick:e.handleBackHome},r.a.createElement("i",{className:"zmdi zmdi-home"}))),r.a.createElement("div",{className:"center",onClick:e.handlePlayAll},e.state.toolbar_msg,r.a.createElement("i",{className:"zmdi zmdi-play-circle"})),r.a.createElement("div",{className:"right"},r.a.createElement(g.ToolbarButton,{onClick:e.handleReset},r.a.createElement("i",{className:"zmdi zmdi-refresh"}))))}},r.a.createElement(g.Modal,{isOpen:this.state.isPostingTts},r.a.createElement("p",null,"Loading ..."),r.a.createElement(g.ProgressCircular,{indeterminate:!0})),r.a.createElement(g.AlertDialog,{isOpen:this.state.errorTitle.length>0,onCancel:this.handleErrorDialogCancel,cancelable:!0},r.a.createElement("div",{className:"alert-dialog-title",onClick:this.handleErrorDialogCancel},r.a.createElement("b",null,this.state.errorTitle)),r.a.createElement("div",{className:"alert-dialog-content"},this.state.errorContent),r.a.createElement("div",{className:"alert-dialog-footer"},r.a.createElement(g.Button,{onClick:this.handleErrorDialogCancel,className:"alert-dialog-button"},"Ok"))),r.a.createElement(g.Row,null,r.a.createElement(g.Col,{width:"20%",verticalAlign:"center",style:{textAlign:"right"}},r.a.createElement("i",{className:"zmdi zmdi-bike"}),"Slow"),r.a.createElement(g.Col,{width:"60^"},r.a.createElement(g.Range,{modifier:"material",style:{width:"100%"},value:this.state.speechSpeed,onChange:function(t){return e.setState({speechSpeed:parseInt(t.target.value)})}})),r.a.createElement(g.Col,{width:"20%",verticalAlign:"center",style:{textAlign:"left"}},r.a.createElement("i",{className:"zmdi zmdi-airplane"}),"Fast")),r.a.createElement(g.Row,null,r.a.createElement(g.Col,null,r.a.createElement("audio",{id:"audioPlayback",controls:!0,src:""}))),r.a.createElement(g.Row,null,r.a.createElement(g.Col,null,r.a.createElement(g.List,{dataSource:this.state.ttsContents,renderRow:function(t,n){return r.a.createElement(g.ListItem,{key:"contentItem-"+n,modifier:n===e.state.ttsContents.length-1?"longdivider":null},r.a.createElement("div",{className:"left",onClick:function(n){e.handlePlay(n,t)}},r.a.createElement("i",{className:"zmdi zmdi-play-circle",style:{fontSize:"1.5em"}})),r.a.createElement("div",{className:"center"},r.a.createElement(g.Input,{type:"text",modifier:"transparent",style:{width:"100%"},value:t,onChange:function(t){return e.handleUpdateItem(t,n)},float:!0})),r.a.createElement("div",{className:"right"},r.a.createElement("i",{className:"zmdi zmdi-caret-up-circle",style:{fontSize:"1.5em"},onClick:function(t){e.handleMoveItem(t,n,-1)}}),"\xa0",r.a.createElement("i",{className:"zmdi zmdi-caret-down-circle",style:{fontSize:"1.5em"},onClick:function(t){e.handleMoveItem(t,n,1)}})))}}))))}}]),t}(a.Component),S="",P="zh-hk",j="zh-tw",w="en-gb",B=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(d.a)(t).call(this,e))).state={lang:S,ttsContent:""},n.resetAll=n.resetAll.bind(Object(m.a)(n)),n.changeToTtsPage=n.changeToTtsPage.bind(Object(m.a)(n)),n.backToOcrPage=n.backToOcrPage.bind(Object(m.a)(n)),n}return Object(h.a)(t,e),Object(i.a)(t,[{key:"changeToTtsPage",value:function(e,t){this.setState({lang:e,ttsContent:t})}},{key:"backToOcrPage",value:function(){this.resetAll()}},{key:"resetAll",value:function(){this.setState({lang:S,ttsContent:""})}},{key:"render",value:function(){return r.a.createElement(g.Page,{id:"MainPage"},""===this.state.ttsContent&&r.a.createElement(E,{onOcrCompleted:this.changeToTtsPage}),this.state.ttsContent&&r.a.createElement(O,{lang:this.state.lang,ttsContent:this.state.ttsContent,onBackToHome:this.backToOcrPage}))}}]),t}(a.Component),N=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement(B,null)}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(N,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[23,1,2]]]);
//# sourceMappingURL=main.9857f58f.chunk.js.map